# リポジトリガイドライン
Codex agents リポジトリはまだ足場を固めている段階です。作業内容を揃え、共同開発しやすくするため、このガイドに従ってください。

## プロジェクト構造とモジュール構成
- 実行可能なコードはすべて `src/` 配下に置き、モジュールパスからインポートできるように保ちます（新しいパッケージを作る場合は空の `__init__.py` を追加してください）。
- 個別のエージェントロジックは `src/agents/<agent_name>/`、共有ユーティリティは `src/shared/`、CLI のオーケストレーションは `src/cli/` に配置します。
- 設定やプロンプト関連のアセットはそれぞれ `configs/` と `assets/` に置き、モジュールをまたぐパイプラインは `docs/` にドキュメント化します。
- `tests/` ではモジュール構成を鏡写しにし（例: `tests/agents/test_researcher.py`）、担当範囲を明確にします。

## ビルド・テスト・開発コマンド
- `python -m venv .venv` — ローカルの仮想環境を作成します。`.gitignore` には有効化スクリプトのみをコミットしてください。
- `source .venv/bin/activate` — 以降の開発コマンドを実行するため仮想環境を有効化します。
- `pip install -r requirements.txt`（`pyproject.toml` が整備されたら `pip install -e .`）— 実行時とツールの依存関係をインストールします。
- `pytest tests` — プッシュ前に必ずテストスイート全体を実行します。
- `ruff check src tests` と `black src tests` — リントと整形を実行し、どちらもクリーンに終了するまで繰り返します。

## コーディングスタイルと命名規則
インデントは 4 スペースを基本とし、文字列フォーマットには f-string を優先して使用します。公開関数には型注釈を付けてください。エージェントのパッケージ名はスネークケース、クラス名はパスカルケース（例: `ResearchAgent`）で揃えます。関数は役割ごとに分割し、短いオーケストレーションヘルパーは `src/cli/` に、長く走るループはエージェントパッケージ内に置きます。コミット前には毎回 `ruff` と `black` を実行し、意図した差分だけがレビュー対象になるようにしてください。

## テストガイドライン
テストは `pytest` で作成し、ファイル名は `test_<module>.py`、テスト関数名は `test_<behavior>` とします。新しいコードでは 85% 以上のカバレッジを目標とし、バグ修正時には回帰テストを追加します。非同期処理のテストには `pytest.mark.asyncio` を活用してください。共通のセットアップが必要な場合は、重複を避けるため `tests/conftest.py` にフィクスチャを用意します。

## コミットとプルリクエストのガイドライン
コミットメッセージは Conventional Commits（`feat`、`fix`、`chore` など）に従い、サブジェクトは 72 文字以内（例: `feat(agent): add planning loop`）に収めます。プルリクエストには簡潔なサマリ、関連する課題番号、テスト証跡（`pytest` の結果や手動検証のスクリーンショットなど）、TODO やフォローアップの共有事項を記載してください。マージ前には、対象エージェントに詳しいレビュアーを最低 1 名アサインしましょう。

## セキュリティと設定のヒント
シークレット類はローカルの `.env` に保存し、`configs/example.env` と同じ構成で管理します。これらはリポジトリにコミットしないでください。新しい外部連携を導入する際は、スコープやトークン、ローテーション方針を `docs/security.md` に記録し、チームがすぐに監査できるようにします。
